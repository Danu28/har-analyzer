<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAR Performance Comparison - Side by Side</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --success-color: #16a34a;
            --warning-color: #ea580c;
            --danger-color: #dc2626;
            --info-color: #0891b2;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--gray-800);
            background-color: var(--gray-50);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--info-color));
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            border-radius: 12px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .comparison-layout {
            display: grid;
            grid-template-columns: 1fr 80px 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .base-column {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--info-color);
        }

        .target-column {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary-color);
        }

        .vs-column {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-600);
            text-align: center;
        }

        .column-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gray-200);
        }

        .column-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--gray-800);
        }

        .column-subtitle {
            font-size: 0.9rem;
            color: var(--gray-600);
            word-break: break-all;
        }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .metric-card {
            background: var(--gray-50);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            border: 1px solid var(--gray-200);
        }

        .metric-label {
            font-size: 0.8rem;
            color: var(--gray-600);
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-800);
        }

        .metric-value.large {
            font-size: 2rem;
        }

        .metric-subtext {
            font-size: 0.8rem;
            color: var(--gray-600);
            margin-top: 5px;
        }

        .performance-grade {
            font-size: 1.2rem;
            font-weight: 700;
            padding: 8px 16px;
            border-radius: 6px;
            display: inline-block;
            margin-top: 5px;
        }

        .grade-excellent {
            background: #dcfce7;
            color: var(--success-color);
        }

        .grade-good {
            background: #dbeafe;
            color: var(--primary-color);
        }

        .grade-fair {
            background: #fef3c7;
            color: var(--warning-color);
        }

        .grade-poor {
            background: #fee2e2;
            color: var(--danger-color);
        }

        .grade-critical {
            background: #fecaca;
            color: #991b1b;
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--gray-800);
            border-bottom: 2px solid var(--gray-200);
            padding-bottom: 10px;
        }

        .summary-status {
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .status-improved {
            background: #dcfce7;
            color: var(--success-color);
            border: 2px solid #bbf7d0;
        }

        .status-regressed {
            background: #fee2e2;
            color: var(--danger-color);
            border: 2px solid #fecaca;
        }

        .status-mixed {
            background: #fef3c7;
            color: var(--warning-color);
            border: 2px solid #fde68a;
        }

        .changes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .change-card {
            background: var(--gray-50);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            border: 1px solid var(--gray-200);
        }

        .change-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .change-positive {
            color: var(--success-color);
        }

        .change-negative {
            color: var(--danger-color);
        }

        .change-neutral {
            color: var(--gray-600);
        }

        .change-label {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .resource-breakdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .resource-type-comparison {
            background: var(--gray-50);
            border-radius: 8px;
            padding: 16px;
            border: 1px solid var(--gray-200);
        }

        .resource-type-header {
            text-align: center;
            margin-bottom: 15px;
            font-weight: 600;
            color: var(--gray-800);
            text-transform: capitalize;
            font-size: 1.1rem;
        }

        .resource-comparison-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid var(--gray-200);
        }

        .resource-comparison-row:last-child {
            border-bottom: none;
        }

        .resource-metric-label {
            font-size: 0.9rem;
            color: var(--gray-600);
        }

        .resource-values {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .resource-base {
            color: var(--info-color);
            font-weight: 500;
        }

        .resource-target {
            color: var(--primary-color);
            font-weight: 500;
        }

        .resource-arrow {
            color: var(--gray-600);
        }

        .delta-indicator {
            font-size: 0.8rem;
            font-weight: 600;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 8px;
        }

        .delta-positive {
            background: #fee2e2;
            color: var(--danger-color);
        }

        .delta-negative {
            background: #dcfce7;
            color: var(--success-color);
        }

        .delta-zero {
            background: var(--gray-200);
            color: var(--gray-600);
        }

        .details-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9rem;
        }

        .details-table th,
        .details-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        .details-table th {
            background: var(--gray-100);
            font-weight: 600;
            color: var(--gray-700);
        }

        .details-table tr:hover {
            background: var(--gray-50);
        }

        .url-cell {
            max-width: 250px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: help;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .badge-added {
            background: #dcfce7;
            color: var(--success-color);
        }

        .badge-removed {
            background: #fee2e2;
            color: var(--danger-color);
        }

        .badge-modified {
            background: #fef3c7;
            color: var(--warning-color);
        }

        .alert {
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-success {
            background: #dcfce7;
            border-color: var(--success-color);
            color: #166534;
        }

        .alert-warning {
            background: #fef3c7;
            border-color: var(--warning-color);
            color: #92400e;
        }

        .alert-danger {
            background: #fee2e2;
            border-color: var(--danger-color);
            color: #991b1b;
        }

        .expandable-section {
            margin-top: 20px;
        }

        .expandable-header {
            cursor: pointer;
            padding: 12px 16px;
            background: var(--gray-100);
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            user-select: none;
        }

        .expandable-header:hover {
            background: var(--gray-200);
        }

        .expandable-content {
            display: none;
            padding: 20px;
            background: var(--gray-50);
            border-radius: 0 0 6px 6px;
            border: 1px solid var(--gray-200);
            border-top: none;
        }

        .expandable-content.show {
            display: block;
        }

        .expand-icon {
            transition: transform 0.3s ease;
        }

        .expand-icon.rotated {
            transform: rotate(180deg);
        }

        .footer {
            text-align: center;
            padding: 30px 0;
            color: var(--gray-600);
            border-top: 1px solid var(--gray-200);
            margin-top: 40px;
        }

        @media (max-width: 1024px) {
            .comparison-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .vs-column {
                display: none;
            }

            .metric-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .changes-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .resource-breakdown-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .metric-card {
                padding: 12px;
            }

            .metric-value {
                font-size: 1.2rem;
            }

            .metric-value.large {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🔄 HAR Performance Comparison</h1>
            <p>Side-by-Side Analysis</p>
        </div>

        <!-- Overall Status -->
        <div class="section">
            <div class="summary-status {{ 'status-improved' if summary.overall_status == 'improved' else 'status-regressed' if summary.overall_status == 'regressed' else 'status-mixed' }}">
                📊 Overall Status: {{ summary.overall_status.title() }} 
                <span style="font-size: 0.9rem; opacity: 0.8;">(Risk Level: {{ summary.risk_level.title() }})</span>
            </div>

            {% if performance_regression.regressions %}
            <div class="alert alert-danger">
                <strong>⚠️ Performance Regressions Detected:</strong>
                <ul style="margin: 10px 0 0 20px;">
                    {% for regression in performance_regression.regressions %}
                    <li>{{ regression.description }} ({{ regression.severity }} severity)</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if performance_regression.improvements %}
            <div class="alert alert-success">
                <strong>✅ Performance Improvements:</strong>
                <ul style="margin: 10px 0 0 20px;">
                    {% for improvement in performance_regression.improvements %}
                    <li>{{ improvement.description }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>

        <!-- Side by Side Performance Metrics -->
        <div class="comparison-layout">
            <div class="base-column">
                <div class="column-header">
                    <div class="column-title">📊 Baseline</div>
                    <div class="column-subtitle">{{ metadata.base_file }}</div>
                </div>

                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="metric-label">Page Load Time</div>
                        <div class="metric-value large">{{ "%.2f"|format(kpi_changes.page_load_time.base) }}s</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">DOM Ready</div>
                        <div class="metric-value">{{ "%.2f"|format(kpi_changes.dom_ready_time.base) }}s</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">Total Requests</div>
                        <div class="metric-value">{{ kpi_changes.total_requests.base }}</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">Total Size</div>
                        <div class="metric-value">{{ "%.2f"|format(kpi_changes.total_size_mb.base) }}</div>
                        <div class="metric-subtext">MB</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">Failed Requests</div>
                        <div class="metric-value">{{ kpi_changes.failed_requests.base }}</div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">Performance Grade</div>
                        <div class="performance-grade grade-{{ kpi_changes.performance_grade_change.base.lower() }}">
                            {{ kpi_changes.performance_grade_change.base }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="vs-column">
                <div>VS</div>
            </div>

            <div class="target-column">
                <div class="column-header">
                    <div class="column-title">📈 Target</div>
                    <div class="column-subtitle">{{ metadata.target_file }}</div>
                </div>

                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="metric-label">Page Load Time</div>
                        <div class="metric-value large">{{ "%.2f"|format(kpi_changes.page_load_time.target) }}s</div>
                        <div class="metric-subtext {{ 'change-positive' if kpi_changes.page_load_time.direction == 'decreased' else 'change-negative' if kpi_changes.page_load_time.direction == 'increased' else 'change-neutral' }}">
                            {{ "%.2f"|format(kpi_changes.page_load_time.absolute) }}s ({{ kpi_changes.page_load_time.percentage }}%)
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">DOM Ready</div>
                        <div class="metric-value">{{ "%.2f"|format(kpi_changes.dom_ready_time.target) }}s</div>
                        <div class="metric-subtext {{ 'change-positive' if kpi_changes.dom_ready_time.direction == 'decreased' else 'change-negative' if kpi_changes.dom_ready_time.direction == 'increased' else 'change-neutral' }}">
                            {{ "%.2f"|format(kpi_changes.dom_ready_time.absolute) }}s ({{ kpi_changes.dom_ready_time.percentage }}%)
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">Total Requests</div>
                        <div class="metric-value">{{ kpi_changes.total_requests.target }}</div>
                        <div class="metric-subtext {{ 'change-positive' if kpi_changes.total_requests.direction == 'decreased' else 'change-negative' if kpi_changes.total_requests.direction == 'increased' else 'change-neutral' }}">
                            {{ "%.0f"|format(kpi_changes.total_requests.absolute) }} ({{ kpi_changes.total_requests.percentage }}%)
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">Total Size</div>
                        <div class="metric-value">{{ "%.2f"|format(kpi_changes.total_size_mb.target) }}</div>
                        <div class="metric-subtext">MB</div>
                        <div class="metric-subtext {{ 'change-positive' if kpi_changes.total_size_mb.direction == 'decreased' else 'change-negative' if kpi_changes.total_size_mb.direction == 'increased' else 'change-neutral' }}">
                            {{ "%.2f"|format(kpi_changes.total_size_mb.absolute) }}MB ({{ kpi_changes.total_size_mb.percentage }}%)
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">Failed Requests</div>
                        <div class="metric-value">{{ kpi_changes.failed_requests.target }}</div>
                        <div class="metric-subtext {{ 'change-positive' if kpi_changes.failed_requests.direction == 'decreased' else 'change-negative' if kpi_changes.failed_requests.direction == 'increased' else 'change-neutral' }}">
                            {{ "%.0f"|format(kpi_changes.failed_requests.absolute) }} ({{ kpi_changes.failed_requests.percentage }}%)
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-label">Performance Grade</div>
                        <div class="performance-grade grade-{{ kpi_changes.performance_grade_change.target.lower() }}">
                            {{ kpi_changes.performance_grade_change.target }}
                        </div>
                        {% if kpi_changes.performance_grade_change.base != kpi_changes.performance_grade_change.target %}
                        <div class="metric-subtext {{ 'change-positive' if kpi_changes.performance_grade_change.improved else 'change-negative' }}">
                            {{ 'Improved' if kpi_changes.performance_grade_change.improved else 'Degraded' }} from {{ kpi_changes.performance_grade_change.base }}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Key Changes Summary -->
        <div class="section">
            <h2>📊 Key Changes Summary</h2>
            <div class="changes-grid">
                <div class="change-card">
                    <div class="change-value {{ 'change-positive' if resource_deltas.counts.added == 0 else 'change-negative' }}">
                        +{{ resource_deltas.counts.added }}
                    </div>
                    <div class="change-label">Resources Added</div>
                </div>

                <div class="change-card">
                    <div class="change-value {{ 'change-positive' if resource_deltas.counts.removed == 0 else 'change-neutral' }}">
                        -{{ resource_deltas.counts.removed }}
                    </div>
                    <div class="change-label">Resources Removed</div>
                </div>

                <div class="change-card">
                    <div class="change-value {{ 'change-neutral' if resource_deltas.counts.modified == 0 else 'change-negative' }}">
                        {{ resource_deltas.counts.modified }}
                    </div>
                    <div class="change-label">Resources Modified</div>
                </div>

                <div class="change-card">
                    <div class="change-value {{ 'change-positive' if third_party_changes.added_domains|length == 0 else 'change-negative' }}">
                        +{{ third_party_changes.added_domains|length }}
                    </div>
                    <div class="change-label">New Domains</div>
                </div>
            </div>
        </div>

        <!-- Resource Type Breakdown -->
        <div class="section">
            <h2>📋 Resource Type Comparison</h2>
            <div class="resource-breakdown-grid">
                {% for resource_type, data in resource_type_aggregates.items() %}
                <div class="resource-type-comparison">
                    <div class="resource-type-header">{{ resource_type.title() }}</div>
                    
                    <div class="resource-comparison-row">
                        <span class="resource-metric-label">Count:</span>
                        <div class="resource-values">
                            <span class="resource-base">{{ data.count.base }}</span>
                            <span class="resource-arrow">→</span>
                            <span class="resource-target">{{ data.count.target }}</span>
                            <span class="delta-indicator {{ 'delta-positive' if data.count.delta > 0 else 'delta-negative' if data.count.delta < 0 else 'delta-zero' }}">
                                {{ "+" if data.count.delta > 0 else "" }}{{ data.count.delta }}
                            </span>
                        </div>
                    </div>
                    
                    <div class="resource-comparison-row">
                        <span class="resource-metric-label">Size:</span>
                        <div class="resource-values">
                            <span class="resource-base">{{ "%.1f"|format(data.size.base / 1024) }}KB</span>
                            <span class="resource-arrow">→</span>
                            <span class="resource-target">{{ "%.1f"|format(data.size.target / 1024) }}KB</span>
                            <span class="delta-indicator {{ 'delta-positive' if data.size.delta > 0 else 'delta-negative' if data.size.delta < 0 else 'delta-zero' }}">
                                {{ "+" if data.size.delta > 0 else "" }}{{ "%.1f"|format(data.size.delta / 1024) }}KB
                            </span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Detailed Resource Changes -->
        {% if resource_deltas.added or resource_deltas.removed or resource_deltas.modified %}
        <div class="section">
            <h2>📦 Detailed Resource Changes</h2>
            
            {% if resource_deltas.added %}
            <div class="expandable-section">
                <div class="expandable-header" onclick="toggleSection(this)">
                    <span>➕ Added Resources ({{ resource_deltas.added|length }})</span>
                    <span class="expand-icon">▼</span>
                </div>
                <div class="expandable-content">
                    <table class="details-table">
                        <thead>
                            <tr>
                                <th>URL</th>
                                <th>Type</th>
                                <th>Domain</th>
                                <th>Size</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for resource in resource_deltas.added[:20] %}
                            <tr>
                                <td class="url-cell" title="{{ resource.url }}">{{ resource.url }}</td>
                                <td><span class="status-badge badge-added">{{ resource.resource_type }}</span></td>
                                <td>{{ resource.domain }}</td>
                                <td>{{ "%.1f"|format(resource.size / 1024) }}KB</td>
                                <td>{{ "%.0f"|format(resource.time) }}ms</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            {% if resource_deltas.removed %}
            <div class="expandable-section">
                <div class="expandable-header" onclick="toggleSection(this)">
                    <span>➖ Removed Resources ({{ resource_deltas.removed|length }})</span>
                    <span class="expand-icon">▼</span>
                </div>
                <div class="expandable-content">
                    <table class="details-table">
                        <thead>
                            <tr>
                                <th>URL</th>
                                <th>Type</th>
                                <th>Domain</th>
                                <th>Size</th>
                                <th>Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for resource in resource_deltas.removed[:20] %}
                            <tr>
                                <td class="url-cell" title="{{ resource.url }}">{{ resource.url }}</td>
                                <td><span class="status-badge badge-removed">{{ resource.resource_type }}</span></td>
                                <td>{{ resource.domain }}</td>
                                <td>{{ "%.1f"|format(resource.size / 1024) }}KB</td>
                                <td>{{ "%.0f"|format(resource.time) }}ms</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}

            {% if resource_deltas.modified %}
            <div class="expandable-section">
                <div class="expandable-header" onclick="toggleSection(this)">
                    <span>🔄 Modified Resources ({{ resource_deltas.modified|length }})</span>
                    <span class="expand-icon">▼</span>
                </div>
                <div class="expandable-content">
                    <table class="details-table">
                        <thead>
                            <tr>
                                <th>URL</th>
                                <th>Type</th>
                                <th>Domain</th>
                                <th>Changes</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for resource in resource_deltas.modified[:20] %}
                            <tr>
                                <td class="url-cell" title="{{ resource.url }}">{{ resource.url }}</td>
                                <td><span class="status-badge badge-modified">{{ resource.resource_type }}</span></td>
                                <td>{{ resource.domain }}</td>
                                <td>
                                    {% if resource.changes.size %}
                                    <span class="{{ 'change-negative' if resource.changes.size.delta > 0 else 'change-positive' }}">
                                        Size: {{ "+" if resource.changes.size.delta > 0 else "" }}{{ "%.1f"|format(resource.changes.size.delta / 1024) }}KB
                                    </span>
                                    {% endif %}
                                    {% if resource.changes.time %}
                                    <span class="{{ 'change-negative' if resource.changes.time.delta > 0 else 'change-positive' }}">
                                        Time: {{ "+" if resource.changes.time.delta > 0 else "" }}{{ "%.0f"|format(resource.changes.time.delta) }}ms
                                    </span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Timing Comparisons -->
        {% if endpoint_timing_diffs.comparisons %}
        <div class="section">
            <h2>⏱️ Significant Timing Changes</h2>
            <div class="alert alert-warning">
                Showing {{ endpoint_timing_diffs.comparisons|length }} endpoints with timing changes > 10ms or 10%.
                {{ endpoint_timing_diffs.summary.improved_count }} improved, {{ endpoint_timing_diffs.summary.regressed_count }} regressed.
            </div>
            
            <div class="expandable-section">
                <div class="expandable-header" onclick="toggleSection(this)">
                    <span>View Timing Details</span>
                    <span class="expand-icon">▼</span>
                </div>
                <div class="expandable-content">
                    <table class="details-table">
                        <thead>
                            <tr>
                                <th>URL</th>
                                <th>Type</th>
                                <th>Base Time</th>
                                <th>Target Time</th>
                                <th>Change</th>
                                <th>% Change</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for timing in endpoint_timing_diffs.comparisons[:15] %}
                            <tr>
                                <td class="url-cell" title="{{ timing.url }}">{{ timing.url }}</td>
                                <td>{{ timing.resource_type }}</td>
                                <td>{{ "%.0f"|format(timing.base_time) }}ms</td>
                                <td>{{ "%.0f"|format(timing.target_time) }}ms</td>
                                <td class="{{ 'change-negative' if timing.time_delta > 0 else 'change-positive' }}">
                                    {{ "+" if timing.time_delta > 0 else "" }}{{ "%.0f"|format(timing.time_delta) }}ms
                                </td>
                                <td class="{{ 'change-negative' if timing.time_delta > 0 else 'change-positive' }}">
                                    {{ timing.percentage_change }}%
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Failed Requests Comparison -->
        {% if failed_requests_comparison.counts.newly_failed > 0 or failed_requests_comparison.counts.fixed > 0 %}
        <div class="section">
            <h2>❌ Failed Requests Analysis</h2>
            
            {% if failed_requests_comparison.newly_failed %}
            <div class="alert alert-danger">
                <strong>⚠️ New Failures ({{ failed_requests_comparison.counts.newly_failed }}):</strong>
                <div style="margin-top: 10px; max-height: 120px; overflow-y: auto; font-family: monospace; font-size: 0.9rem;">
                    {% for url in failed_requests_comparison.newly_failed %}
                    <div>• {{ url }}</div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            {% if failed_requests_comparison.fixed_requests %}
            <div class="alert alert-success">
                <strong>✅ Fixed Requests ({{ failed_requests_comparison.counts.fixed }}):</strong>
                <div style="margin-top: 10px; max-height: 120px; overflow-y: auto; font-family: monospace; font-size: 0.9rem;">
                    {% for url in failed_requests_comparison.fixed_requests %}
                    <div>• {{ url }}</div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Footer -->
        <div class="footer">
            <p><strong>HAR-ANALYZE</strong> - Side-by-Side Performance Comparison Report</p>
            <p style="font-size: 0.9rem; margin-top: 5px;">
                Generated on {{ metadata.comparison_timestamp }}
            </p>
        </div>
    </div>

    <script>
        function toggleSection(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.expand-icon');
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                icon.textContent = '▼';
                icon.classList.remove('rotated');
            } else {
                content.classList.add('show');
                icon.textContent = '▲';
                icon.classList.add('rotated');
            }
        }

        // Auto-expand sections with critical information
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-expand if there are regressions or significant changes
            const hasRegressions = {{ 'true' if performance_regression.regressions else 'false' }};
            const hasNewFailures = {{ 'true' if failed_requests_comparison.counts.newly_failed > 0 else 'false' }};
            
            if (hasRegressions || hasNewFailures) {
                // Auto-expand critical sections
                const criticalSections = document.querySelectorAll('.expandable-header');
                criticalSections.forEach(header => {
                    const text = header.textContent.toLowerCase();
                    if (text.includes('modified') || text.includes('timing')) {
                        toggleSection(header);
                    }
                });
            }
        });
    </script>
</body>
</html>
