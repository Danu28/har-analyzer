<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAR Performance Analysis - Detailed Report</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --success-color: #16a34a;
            --warning-color: #ea580c;
            --danger-color: #dc2626;
            --info-color: #0891b2;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--gray-800);
            background-color: var(--gray-50);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--info-color));
            color: white;
            padding: 30px 0;
            margin-bottom: 30px;
            border-radius: 12px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .summary-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-left: 4px solid var(--primary-color);
        }

        .summary-card.grade-a, .summary-card.grade-aplus {
            border-left-color: var(--success-color);
        }

        .summary-card.grade-b {
            border-left-color: var(--info-color);
        }

        .summary-card.grade-c {
            border-left-color: var(--warning-color);
        }

        .summary-card.grade-d, .summary-card.grade-f {
            border-left-color: var(--danger-color);
        }

        .summary-card h3 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--gray-800);
        }

        .performance-grade {
            font-size: 3rem;
            font-weight: 900;
            text-align: center;
            margin: 10px 0;
        }

        .grade-a, .grade-aplus { color: var(--success-color); }
        .grade-b { color: var(--info-color); }
        .grade-c { color: var(--warning-color); }
        .grade-d, .grade-f { color: var(--danger-color); }

        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .metric-item {
            text-align: center;
            padding: 15px;
            background: var(--gray-50);
            border-radius: 8px;
        }

        .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-value.success { color: var(--success-color); }
        .metric-value.warning { color: var(--warning-color); }
        .metric-value.danger { color: var(--danger-color); }
        .metric-value.info { color: var(--info-color); }

        .metric-label {
            font-size: 0.9rem;
            color: var(--gray-700);
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--gray-800);
            border-bottom: 2px solid var(--gray-200);
            padding-bottom: 10px;
        }

        .insights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .insight-card {
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .insight-card.issues {
            background: #fef2f2;
            border-left-color: var(--danger-color);
        }

        .insight-card.recommendations {
            background: #fefbeb;
            border-left-color: var(--warning-color);
        }

        .insight-card.strengths {
            background: #f0fdf4;
            border-left-color: var(--success-color);
        }

        .insight-card h4 {
            margin-bottom: 10px;
            color: var(--gray-800);
        }

        .insight-list {
            list-style: none;
            padding: 0;
        }

        .insight-list li {
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .insight-list li::before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--primary-color);
            font-weight: bold;
        }

        .table-container {
            overflow-x: auto;
            margin-top: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--gray-200);
        }

        th {
            background: var(--gray-100);
            font-weight: 600;
            color: var(--gray-700);
        }

        tr:hover {
            background: var(--gray-50);
        }

        .url-cell {
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
        }

        .url-cell:hover {
            color: var(--primary-color);
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-2xx { background: #dcfce7; color: var(--success-color); }
        .status-3xx { background: #fef3c7; color: var(--warning-color); }
        .status-4xx { background: #fee2e2; color: var(--danger-color); }
        .status-5xx { background: #fecaca; color: #991b1b; }

        .chart-container {
            height: 300px;
            background: var(--gray-50);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-700);
            margin: 20px 0;
            flex-wrap: wrap;
            padding: 20px;
        }

        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }

        .chart-legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-color-box {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .priority-actions {
            background: #fef2f2;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid var(--danger-color);
            margin-top: 20px;
        }

        .priority-actions h4 {
            color: var(--danger-color);
            margin-bottom: 10px;
        }

        .footer {
            text-align: center;
            padding: 30px 0;
            color: var(--gray-700);
            border-top: 1px solid var(--gray-200);
            margin-top: 40px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .summary-grid {
                grid-template-columns: 1fr;
            }

            .metric-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }

            .insights-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>📊 HAR Performance Analysis</h1>
            <p>{{ metadata.har_name or 'Performance Report' }}</p>
        </div>

        <!-- Summary Cards -->
        <div class="summary-grid">
            <div class="summary-card grade-{{ performance_summary.performance_grade.lower().replace('+', 'plus') }}">
                <h3>Overall Performance Grade</h3>
                <div class="performance-grade grade-{{ performance_summary.performance_grade.lower().replace('+', 'plus') }}">
                    {{ performance_summary.performance_grade }}
                </div>
                <p style="text-align: center; color: var(--gray-700);">
                    Based on loading times, request efficiency, and error rates
                </p>
            </div>

            <div class="summary-card">
                <h3>📈 Key Metrics</h3>
                <div class="metric-grid">
                    <div class="metric-item">
                        <div class="metric-value {{ 'success' if performance_summary.page_load_time|replace('s', '')|float < 3 else 'warning' if performance_summary.page_load_time|replace('s', '')|float < 5 else 'danger' }}">
                            {{ performance_summary.page_load_time or 'N/A' }}
                        </div>
                        <div class="metric-label">Page Load</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value {{ 'success' if performance_summary.dom_ready_time|replace('s', '')|float < 2 else 'warning' if performance_summary.dom_ready_time|replace('s', '')|float < 5 else 'danger' }}">
                            {{ performance_summary.dom_ready_time or 'N/A' }}
                        </div>
                        <div class="metric-label">DOM Ready</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value {{ 'success' if performance_summary.total_requests < 30 else 'warning' if performance_summary.total_requests < 50 else 'danger' }}">
                            {{ performance_summary.total_requests or 0 }}
                        </div>
                        <div class="metric-label">Requests</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value {{ 'danger' if failed_requests|length > 0 else 'success' }}">
                            {{ failed_requests|length }}
                        </div>
                        <div class="metric-label">Failed</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Insights -->
        <div class="section">
            <h2>🔍 Performance Insights</h2>
            <div class="insights-grid">
                {% if performance_insights.issues %}
                <div class="insight-card issues">
                    <h4>⚠️ Issues Found</h4>
                    <ul class="insight-list">
                        {% for issue in performance_insights.issues %}
                        <li>{{ issue }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if performance_insights.recommendations %}
                <div class="insight-card recommendations">
                    <h4>💡 Recommendations</h4>
                    <ul class="insight-list">
                        {% for rec in performance_insights.recommendations %}
                        <li>{{ rec }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}

                {% if performance_insights.strengths %}
                <div class="insight-card strengths">
                    <h4>✅ Strengths</h4>
                    <ul class="insight-list">
                        {% for strength in performance_insights.strengths %}
                        <li>{{ strength }}</li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>

            {% if performance_insights.priority_actions %}
            <div class="priority-actions">
                <h4>🚨 Priority Actions</h4>
                <ul class="insight-list">
                    {% for action in performance_insights.priority_actions %}
                    <li style="color: var(--danger-color);">{{ action }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>

        <!-- Resource Breakdown -->
        <div class="section">
            <h2>📦 Resource Breakdown</h2>
            <div class="chart-container">
                <div style="width: 100%;">
                    <h3 style="text-align: center; margin-bottom: 20px;">Resource Types Distribution</h3>
                    <div class="chart-legend">
                        {% for item in chart_data.resource_breakdown %}
                        <div class="chart-legend-item">
                            <div class="chart-color-box" style="background: {{ item.color }};"></div>
                            <span>{{ item.label }}: {{ item.value }}</span>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Largest Assets -->
        {% if largest_assets %}
        <div class="section">
            <h2>📏 Largest Assets</h2>
            <p style="margin-bottom: 15px; color: var(--gray-700);">
                Top {{ largest_assets|length }} largest resources that may impact performance
            </p>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Asset</th>
                            <th>Size</th>
                            <th>Type</th>
                            <th>Domain</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for asset in largest_assets[:15] %}
                        <tr>
                            <td class="url-cell" title="{{ asset.url }}">{{ asset.url }}</td>
                            <td>{{ "%.1f"|format(asset.size_kb) }} KB</td>
                            <td>{{ asset.resource_type or 'unknown' }}</td>
                            <td>{{ asset.domain or 'N/A' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        <!-- Slowest Requests -->
        {% if slowest_requests %}
        <div class="section">
            <h2>🐌 Slowest Requests</h2>
            <p style="margin-bottom: 15px; color: var(--gray-700);">
                Requests with the highest response times
            </p>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Request</th>
                            <th>Time</th>
                            <th>Status</th>
                            <th>Size</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for req in slowest_requests[:15] %}
                        <tr>
                            <td class="url-cell" title="{{ req.url }}">{{ req.url }}</td>
                            <td>{{ "%.0f"|format(req.time_ms) }} ms</td>
                            <td><span class="status-badge status-200">{{ req.get('status', 'N/A') }}</span></td>
                            <td>{{ "%.1f"|format((req.get('size', 0)) / 1024) }} KB</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        <!-- Failed Requests -->
        {% if failed_requests %}
        <div class="section">
            <h2>❌ Failed Requests</h2>
            <p style="margin-bottom: 15px; color: var(--gray-700);">
                Requests that failed to load successfully
            </p>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Request</th>
                            <th>Status</th>
                            <th>Error Type</th>
                            <th>Domain</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for req in failed_requests %}
                        <tr>
                            <td class="url-cell" title="{{ req.url }}">{{ req.url }}</td>
                            <td><span class="status-badge status-{{ (req.status // 100)|string }}xx">{{ req.status or 'N/A' }}</span></td>
                            <td>{{ req.get('error_type', 'Network Error') }}</td>
                            <td>{{ req.get('domain', req.url.split('/')[2] if '/' in req.url else 'N/A') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        <!-- Compression Analysis -->
        {% if compression_analysis.compression_opportunity_count > 0 %}
        <div class="section">
            <h2>🗜️ Compression Opportunities</h2>
            <p style="margin-bottom: 15px; color: var(--gray-700);">
                Resources that could benefit from compression
            </p>
            <div style="background: var(--gray-50); padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                <strong>Potential Savings:</strong> {{ "%.1f"|format(compression_analysis.total_potential_savings_kb) }} KB from {{ compression_analysis.compression_opportunity_count }} resources
            </div>
            {% if compression_analysis.uncompressed_resources %}
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Resource</th>
                            <th>Current Size</th>
                            <th>Potential Savings</th>
                            <th>Type</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for resource in compression_analysis.uncompressed_resources[:10] %}
                        <tr>
                            <td class="url-cell" title="{{ resource.url }}">{{ resource.url }}</td>
                            <td>{{ "%.1f"|format(resource.size / 1024) }} KB</td>
                            <td>{{ "%.1f"|format(resource.potential_savings / 1024) }} KB</td>
                            <td>{{ resource.resourceType or 'unknown' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Caching Analysis -->
        {% if caching_analysis.no_cache_resources or caching_analysis.short_cache_resources %}
        <div class="section">
            <h2>🔄 Caching Optimization</h2>
            <p style="margin-bottom: 15px; color: var(--gray-700);">
                Resources with caching optimization opportunities
            </p>
            
            <div class="metric-grid" style="margin-bottom: 20px;">
                <div class="metric-item">
                    <div class="metric-value danger">{{ caching_analysis.no_cache_resources|length }}</div>
                    <div class="metric-label">No Cache Headers</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value warning">{{ caching_analysis.short_cache_resources|length }}</div>
                    <div class="metric-label">Short Cache Duration</div>
                </div>
            </div>

            {% if caching_analysis.no_cache_resources %}
            <h4 style="margin-bottom: 10px; color: var(--danger-color);">Resources without cache headers:</h4>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Resource</th>
                            <th>Type</th>
                            <th>Size</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for resource in caching_analysis.no_cache_resources[:10] %}
                        <tr>
                            <td class="url-cell" title="{{ resource.url }}">{{ resource.url }}</td>
                            <td>{{ resource.resourceType or 'unknown' }}</td>
                            <td>{{ "%.1f"|format((resource.size or 0) / 1024) }} KB</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endif %}
        </div>
        {% endif %}

        <!-- Footer -->
        <div class="footer">
            <p>Generated by HAR-ANALYZE Performance Analysis Tool</p>
            <p style="font-size: 0.9rem; margin-top: 5px; color: var(--gray-700);">
                Detailed Template • Report generated on {{ metadata.report_timestamp }}
            </p>
        </div>
    </div>

    <script>
        // Add tooltip functionality for long URLs
        document.querySelectorAll('.url-cell').forEach(cell => {
            cell.addEventListener('mouseenter', function() {
                if (this.offsetWidth < this.scrollWidth) {
                    this.setAttribute('title', this.textContent);
                }
            });
        });

        // Add table sorting functionality
        document.querySelectorAll('table th').forEach(th => {
            th.style.cursor = 'pointer';
            th.addEventListener('click', function() {
                const table = this.closest('table');
                const tbody = table.querySelector('tbody');
                const rows = Array.from(tbody.querySelectorAll('tr'));
                const columnIndex = Array.from(this.parentNode.children).indexOf(this);
                
                const isAscending = this.classList.contains('sort-asc');
                
                // Remove sort classes from all headers
                table.querySelectorAll('th').forEach(header => {
                    header.classList.remove('sort-asc', 'sort-desc');
                });
                
                // Add appropriate sort class
                this.classList.add(isAscending ? 'sort-desc' : 'sort-asc');
                
                // Sort rows
                rows.sort((a, b) => {
                    const aValue = a.children[columnIndex].textContent.trim();
                    const bValue = b.children[columnIndex].textContent.trim();
                    
                    // Try to parse as numbers
                    const aNum = parseFloat(aValue.replace(/[^\d.-]/g, ''));
                    const bNum = parseFloat(bValue.replace(/[^\d.-]/g, ''));
                    
                    if (!isNaN(aNum) && !isNaN(bNum)) {
                        return isAscending ? aNum - bNum : bNum - aNum;
                    } else {
                        return isAscending 
                            ? aValue.localeCompare(bValue) 
                            : bValue.localeCompare(aValue);
                    }
                });
                
                // Re-append sorted rows
                rows.forEach(row => tbody.appendChild(row));
            });
        });
    </script>
</body>
</html>
